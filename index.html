<!doctype html><html lang="pl"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Wizyta — nowy front</title><meta name="description" content="Wizyta — nowoczesny front dla Powiernika. Lokalny host z offline STT + baza, a UI działa w przeglądarce." /><meta name="theme-color" content="#0a0f1f" /><link rel="preconnect" href="https://fonts.googleapis.com" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link href="https://fonts.googleapis.com/css2?family=Syne:wght@500;600;700&family=Onest:wght@300;400;500;600&display=swap" rel="stylesheet" /><style>:root{color-scheme:light;--bg:#0a0f1f;--bg-soft:#101a31;--ink:#f2f5ff;--muted:rgba(242,245,255,0.68);--accent:#6ef3d6;--accent-2:#6c8cff;--accent-3:#f9a8d4;--panel:rgba(12,18,34,0.78);--panel-strong:rgba(16,26,49,0.9);--border:rgba(255,255,255,0.08);--shadow:0 20px 60px rgba(6,10,20,0.45);--radius:20px;}*{box-sizing:border-box;}body{margin:0;font-family:"Onest","Segoe UI",sans-serif;background:radial-gradient(1200px 600px at 10% 0%,rgba(110,243,214,0.2),transparent 55%),radial-gradient(900px 600px at 90% 10%,rgba(108,140,255,0.3),transparent 60%),linear-gradient(180deg,#070b18 0%,#0b1224 45%,#0a0f1f 100%);color:var(--ink);min-height:100vh;overflow-x:hidden;}.aura{position:fixed;inset:0;background:radial-gradient(400px 200px at 70% 20%,rgba(249,168,212,0.35),transparent 60%),radial-gradient(500px 260px at 30% 80%,rgba(108,140,255,0.2),transparent 70%);pointer-events:none;opacity:0.6;mix-blend-mode:screen;}.gridline{position:fixed;inset:0;background-image:linear-gradient(rgba(255,255,255,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.04) 1px,transparent 1px);background-size:80px 80px;mask-image:radial-gradient(circle at 50% 30%,rgba(0,0,0,0.4),transparent 70%);pointer-events:none;}.site-header{display:flex;justify-content:space-between;align-items:center;padding:28px clamp(24px,6vw,80px) 16px;position:relative;z-index:2;}.brand{display:flex;gap:14px;align-items:center;}.brand-mark{width:46px;height:46px;border-radius:16px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-family:"Syne",sans-serif;font-weight:700;color:#020713;box-shadow:var(--shadow);}.brand-copy{display:grid;gap:2px;}.brand-title{font-family:"Syne",sans-serif;font-size:20px;font-weight:600;}.brand-sub{font-size:13px;color:var(--muted);}.header-actions{display:flex;gap:12px;}.wrap{padding:20px clamp(24px,6vw,80px) 80px;position:relative;z-index:1;}.hero{display:grid;gap:28px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));align-items:center;margin-bottom:48px;}.hero-text{display:grid;gap:18px;animation:fadeUp 0.7s ease both;}.kicker{text-transform:uppercase;letter-spacing:0.2em;font-size:12px;color:var(--muted);}h1{font-family:"Syne",sans-serif;font-size:clamp(32px,4vw,52px);line-height:1.04;margin:0;}.lead{color:var(--muted);font-size:16px;max-width:560px;}.hero-actions{display:flex;gap:12px;flex-wrap:wrap;}.hero-meta{font-size:13px;color:rgba(255,255,255,0.45);}.hero-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:24px;display:grid;gap:18px;box-shadow:var(--shadow);animation:floatIn 0.8s ease both;}.status-row{display:flex;gap:12px;align-items:center;}.status-dot{width:14px;height:14px;border-radius:50%;background:#ff6b6b;box-shadow:0 0 12px rgba(255,107,107,0.7);}.status-dot.good{background:#6ef3d6;box-shadow:0 0 14px rgba(110,243,214,0.8);}.status-title{font-weight:600;font-size:16px;}.status-sub{font-size:13px;color:var(--muted);}.host-input label{font-size:12px;color:var(--muted);}.host-row{display:flex;gap:10px;margin-top:8px;}input[type="text"]{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(8,14,28,0.7);color:var(--ink);font-size:14px;}.hint{font-size:12px;color:rgba(255,255,255,0.5);}.quick-links{display:flex;gap:10px;flex-wrap:wrap;}.chip{padding:8px 14px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,0.04);font-size:12px;text-decoration:none;color:var(--ink);cursor:pointer;}.grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));}.panel{background:var(--panel-strong);border:1px solid var(--border);border-radius:var(--radius);padding:22px;display:grid;gap:14px;box-shadow:var(--shadow);}.panel.wide{grid-column:1 / -1;}.panel h2{margin:0;font-family:"Syne",sans-serif;font-size:20px;}.small{color:var(--muted);font-size:13px;}.panel-actions,.panel-foot{display:flex;gap:10px;flex-wrap:wrap;}.kv{display:grid;gap:12px;}.kv div{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(255,255,255,0.12);padding-bottom:8px;}.kv span{color:var(--muted);font-size:12px;}.kv strong{font-weight:600;}.steps{display:grid;gap:16px;}.step{display:flex;gap:14px;align-items:flex-start;}.step-num{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-3));color:#04111d;font-weight:700;display:grid;place-items:center;}.log-box{background:rgba(6,10,20,0.8);border:1px solid var(--border);border-radius:14px;padding:12px;min-height:140px;font-family:"SFMono-Regular",Consolas,"Liberation Mono",monospace;font-size:12px;color:#c9d7ff;white-space:pre-wrap;overflow:auto;}.debug{margin-top:32px;border:1px dashed rgba(255,255,255,0.16);border-radius:var(--radius);padding:18px;background:rgba(7,12,24,0.6);}.debug-head{display:flex;justify-content:space-between;align-items:center;}.site-footer{display:flex;justify-content:space-between;gap:12px;padding:24px clamp(24px,6vw,80px) 32px;color:rgba(255,255,255,0.5);font-size:12px;}.footer-links{display:flex;gap:8px;align-items:center;}button{border:none;font-family:"Onest",sans-serif;cursor:pointer;}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#02111d;font-weight:600;padding:12px 18px;border-radius:12px;box-shadow:var(--shadow);transition:transform 0.2s ease,box-shadow 0.2s ease;}button.primary:hover{transform:translateY(-1px);}button.ghost{background:rgba(255,255,255,0.06);color:var(--ink);padding:12px 16px;border-radius:12px;border:1px solid var(--border);}button.ghost:hover{border-color:rgba(255,255,255,0.2);}@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}@keyframes floatIn{from{opacity:0;transform:translateY(20px) scale(0.98);}to{opacity:1;transform:translateY(0) scale(1);}}@media (max-width:720px){.header-actions{display:none;}.site-footer{flex-direction:column;}}</style></head><body><div class="aura"></div><div class="gridline"></div><header class="site-header"><div class="brand"><div class="brand-mark">W</div><div class="brand-copy"><span class="brand-title">Wizyta</span><span class="brand-sub">Front + Powiernik offline</span></div></div><div class="header-actions"><button class="ghost" id="open-local">Otwórz lokalny UI</button><button class="primary" id="connect-now">Sprawdź połączenie</button></div></header><main class="wrap"><section class="hero"><div class="hero-text"><p class="kicker">/wizyta</p><h1>Nowoczesny front, lokalny Powiernik, pełna kontrola.</h1><p class="lead"> UI działa w przeglądarce (GitHub Pages), a offline STT i baza pozostają na hoście. Wystarczy uruchomić Powiernika lokalnie i połączyć go z tym panelem. </p><div class="hero-actions"><button class="primary" id="scan-ports">Znajdź Powiernika</button><button class="ghost" id="copy-debug">Skopiuj paczkę debug</button></div><div class="hero-meta" id="hero-meta">Ostatnie sprawdzenie: —</div></div><div class="hero-card"><div class="status-row"><span class="status-dot" id="status-dot"></span><div><div class="status-title" id="status-title">Brak połączenia</div><div class="status-sub" id="status-sub">Podłącz Powiernika i kliknij „Sprawdź połączenie”.</div></div></div><div class="host-input"><label for="host">Adres Powiernika</label><div class="host-row"><input id="host" type="text" value="http://127.0.0.1:8089" spellcheck="false" /><button class="ghost" id="save-host">Zapisz</button></div><p class="hint">Jeśli przeglądarka blokuje HTTPS → HTTP, włącz tryb HTTPS w Powierniku lub użyj lokalnej strony.</p></div><div class="quick-links"><a class="chip" data-open="/">UI główne</a><a class="chip" data-open="/live">Live interview</a><a class="chip" data-open="/history">Historia</a><a class="chip" id="open-logs">Logi Powiernika</a></div></div></section><section class="grid"><article class="panel"><h2>Status Powiernika</h2><div class="kv"><div><span>Backend</span><strong id="backend-value">—</strong></div><div><span>Model</span><strong id="model-value">—</strong></div><div><span>Urządzenie</span><strong id="device-value">—</strong></div><div><span>Port</span><strong id="port-value">—</strong></div></div><div class="panel-foot"><button class="ghost" id="refresh-status">Odśwież status</button><button class="ghost" id="open-health">Otwórz /api/health</button></div></article><article class="panel"><h2>Powiernik — debug</h2><p class="small"> Jeden klik i masz paczkę logów do wklejenia. Pobieramy ostatnie linie z hosta i łączymy je z logami frontu. </p><div class="panel-actions"><button class="primary" id="fetch-backend-logs">Pobierz logi hosta</button><button class="ghost" id="copy-frontend-logs">Kopiuj logi frontu</button></div><div class="log-box" id="backend-log-preview">Logi hosta pojawią się tutaj…</div></article><article class="panel wide"><h2>Co dalej?</h2><div class="steps"><div class="step"><div class="step-num">1</div><div><strong>Uruchom Powiernika lokalnie</strong><p>Powiernik to proces, który robi offline STT i obsługuje bazę.</p></div></div><div class="step"><div class="step-num">2</div><div><strong>Połącz się z hostem</strong><p>Wpisz adres (np. 127.0.0.1:8089) i kliknij „Sprawdź połączenie”.</p></div></div><div class="step"><div class="step-num">3</div><div><strong>Pracuj w nowym froncie</strong><p>Najważniejsze akcje są tutaj, reszta pozostaje w lokalnym UI.</p></div></div></div></article></section><section class="debug" id="debug-panel"><div class="debug-head"><h3>Debug Console</h3><button class="ghost" id="clear-logs">Wyczyść</button></div><div class="log-box" id="frontend-log-box"></div></section></main><footer class="site-footer"><div>Wizyta © 2026</div><div class="footer-links"><span>GitHub Pages: guziczak.github.io/wizyta</span></div></footer><script>const state = { host: localStorage.getItem('wizytaHost') || 'http://127.0.0.1:8089', frontendLogs: [], backendLogs: '', lastHealth: null,
};
const $ = (id) => document.getElementById(id);
const hostInput = $('host');
const statusDot = $('status-dot');
const statusTitle = $('status-title');
const statusSub = $('status-sub');
const heroMeta = $('hero-meta');
const backendValue = $('backend-value');
const modelValue = $('model-value');
const deviceValue = $('device-value');
const portValue = $('port-value');
const backendLogPreview = $('backend-log-preview');
const frontendLogBox = $('frontend-log-box');
const log = (level, message, data) => { const entry = { time: new Date().toISOString(), level, message, data: data ?? null, }; state.frontendLogs.push(entry); if (state.frontendLogs.length > 300) { state.frontendLogs.shift(); } const line = `[${entry.time}] [${level}] ${message}` + (data ? ` | ${JSON.stringify(data)}` : ''); if (frontendLogBox) { frontendLogBox.textContent = `${line}\n${frontendLogBox.textContent}`.trim(); } if (level === 'error') { console.error(message, data || ''); } else { console.log(message, data || ''); }
};
const setStatus = (ok, title, subtitle) => { statusDot.classList.toggle('good', ok); statusTitle.textContent = title; statusSub.textContent = subtitle;
};
const setHost = (value) => { state.host = value.trim(); hostInput.value = state.host; localStorage.setItem('wizytaHost', state.host); log('info', 'Host ustawiony', { host: state.host });
};
const fetchWithTimeout = async (url, options = {}, timeoutMs = 2500) => { const controller = new AbortController(); const timeout = setTimeout(() => controller.abort(), timeoutMs); try { const res = await fetch(url, { ...options, signal: controller.signal, cache: 'no-store', }); return res; } finally { clearTimeout(timeout); }
};
const updateHealthUI = (data) => { backendValue.textContent = data.backend || '—'; modelValue.textContent = data.model || '—'; deviceValue.textContent = data.device || '—'; portValue.textContent = data.port ? String(data.port) : '—';
};
const checkHealth = async () => { const start = new Date(); heroMeta.textContent = `Ostatnie sprawdzenie: ${start.toLocaleTimeString('pl-PL')}`; try { const res = await fetchWithTimeout(`${state.host}/api/health`, { mode: 'cors' }, 3000); if (!res.ok) { throw new Error(`HTTP ${res.status}`); } const data = await res.json(); state.lastHealth = data; updateHealthUI(data); setStatus(true, 'Połączono z Powiernikiem', data.message || 'Host odpowiada poprawnie.'); log('info', 'Powiernik online', data); return true; } catch (err) { setStatus(false, 'Brak połączenia', 'Nie udało się pobrać /api/health.'); log('error', 'Powiernik offline lub blokada przeglądarki', { error: String(err) }); return false; }
};
const scanPorts = async () => { log('info', 'Skanowanie portów 8089-8100...'); const ports = Array.from({ length: 12 }, (_, i) => 8089 + i); for (const port of ports) { const candidate = `${state.host.replace(/:\d+$/, '')}:${port}`; try { const res = await fetchWithTimeout(`${candidate}/api/health`, { mode: 'cors' }, 1200); if (res.ok) { setHost(candidate); await checkHealth(); return; } } catch (err) { // ignore } } log('warn', 'Nie znaleziono Powiernika na standardowych portach.');
};
const fetchBackendLogs = async () => { try { const res = await fetchWithTimeout(`${state.host}/api/debug/logs?tail=200`, { mode: 'cors' }, 4000); if (!res.ok) { throw new Error(`HTTP ${res.status}`); } const data = await res.json(); const text = data.lines ? data.lines.join('\n') : (data.stdout_lines || []).join('\n'); state.backendLogs = text || JSON.stringify(data, null, 2); backendLogPreview.textContent = state.backendLogs || 'Brak logów.'; log('info', 'Pobrano logi hosta', { lines: (data.lines || []).length }); } catch (err) { backendLogPreview.textContent = `Błąd pobierania logów: ${err}`; log('error', 'Nie udało się pobrać logów hosta', { error: String(err) }); }
};
const copyToClipboard = async (text) => { try { await navigator.clipboard.writeText(text); log('info', 'Skopiowano do schowka'); } catch (err) { log('error', 'Nie udało się skopiować do schowka', { error: String(err) }); }
};
const buildDebugBundle = () => { return JSON.stringify({ generated_at: new Date().toISOString(), host: state.host, user_agent: navigator.userAgent, health: state.lastHealth, frontend_logs: state.frontendLogs, backend_logs: state.backendLogs, }, null, 2);
};
const openLocal = (path) => { const url = `${state.host}${path}`; window.open(url, '_blank', 'noopener'); log('info', 'Otwarto lokalny adres', { url });
};
window.addEventListener('error', (event) => { log('error', 'Wyjątek frontu', { message: event.message, source: event.filename, line: event.lineno });
});
window.addEventListener('unhandledrejection', (event) => { log('error', 'Nieobsłużone odrzucenie', { reason: String(event.reason) });
});
hostInput.value = state.host;
$('save-host').addEventListener('click', () => setHost(hostInput.value));
$('connect-now').addEventListener('click', checkHealth);
$('refresh-status').addEventListener('click', checkHealth);
$('scan-ports').addEventListener('click', scanPorts);
$('open-local').addEventListener('click', () => openLocal('/'));
$('open-health').addEventListener('click', () => openLocal('/api/health'));
$('fetch-backend-logs').addEventListener('click', fetchBackendLogs);
$('copy-frontend-logs').addEventListener('click', () => copyToClipboard(JSON.stringify(state.frontendLogs, null, 2)));
$('copy-debug').addEventListener('click', () => copyToClipboard(buildDebugBundle()));
$('open-logs').addEventListener('click', fetchBackendLogs);
$('clear-logs').addEventListener('click', () => { state.frontendLogs = []; frontendLogBox.textContent = '';
});
Array.from(document.querySelectorAll('[data-open]')).forEach((el) => { el.addEventListener('click', () => openLocal(el.getAttribute('data-open')));
});
log('info', 'Front uruchomiony');
checkHealth();</script></body></html>
