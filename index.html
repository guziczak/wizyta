<!doctype html><html lang="pl"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Wizyta - nowoczesny wywiad z Powiernikiem</title><meta name="description" content="Wizyta - nowoczesny front + lokalny Powiernik (offline STT i baza)." /><meta name="theme-color" content="#0a0f1f" /><link rel="preconnect" href="https://fonts.googleapis.com" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link href="https://fonts.googleapis.com/css2?family=Syne:wght@500;600;700&family=Onest:wght@300;400;500;600&display=swap" rel="stylesheet" /><style>:root{color-scheme:light;--bg:#0a0f1f;--ink:#f2f5ff;--muted:rgba(242,245,255,0.68);--accent:#6ef3d6;--accent-2:#6c8cff;--accent-3:#f9a8d4;--panel:rgba(12,18,34,0.78);--panel-strong:rgba(16,26,49,0.9);--border:rgba(255,255,255,0.08);--shadow:0 20px 60px rgba(6,10,20,0.45);--radius:20px;}*{box-sizing:border-box;}body{margin:0;font-family:"Onest","Segoe UI",sans-serif;background:radial-gradient(1200px 600px at 10% 0%,rgba(110,243,214,0.2),transparent 55%),radial-gradient(900px 600px at 90% 10%,rgba(108,140,255,0.3),transparent 60%),linear-gradient(180deg,#070b18 0%,#0b1224 45%,#0a0f1f 100%);color:var(--ink);min-height:100vh;overflow-x:hidden;}.aura{position:fixed;inset:0;background:radial-gradient(400px 200px at 70% 20%,rgba(249,168,212,0.35),transparent 60%),radial-gradient(500px 260px at 30% 80%,rgba(108,140,255,0.2),transparent 70%);pointer-events:none;opacity:0.6;mix-blend-mode:screen;}.gridline{position:fixed;inset:0;background-image:linear-gradient(rgba(255,255,255,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.04) 1px,transparent 1px);background-size:80px 80px;mask-image:radial-gradient(circle at 50% 30%,rgba(0,0,0,0.4),transparent 70%);pointer-events:none;}.site-header{display:flex;justify-content:space-between;align-items:center;padding:28px clamp(24px,6vw,80px) 8px;position:relative;z-index:2;}.brand{display:flex;gap:14px;align-items:center;}.brand-mark{width:46px;height:46px;border-radius:16px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-family:"Syne",sans-serif;font-weight:700;color:#020713;box-shadow:var(--shadow);}.brand-copy{display:grid;gap:2px;}.brand-title{font-family:"Syne",sans-serif;font-size:20px;font-weight:600;}.brand-sub{font-size:13px;color:var(--muted);}.wrap{padding:12px clamp(24px,6vw,80px) 64px;position:relative;z-index:1;}.hero{display:grid;gap:28px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));align-items:center;}.hero-text{display:grid;gap:16px;animation:fadeUp 0.7s ease both;}.kicker{text-transform:uppercase;letter-spacing:0.2em;font-size:12px;color:var(--muted);}h1{font-family:"Syne",sans-serif;font-size:clamp(32px,4vw,52px);line-height:1.04;margin:0;}.lead{color:var(--muted);font-size:16px;max-width:560px;}.hero-actions{display:flex;gap:12px;flex-wrap:wrap;}.hint{font-size:12px;color:rgba(255,255,255,0.5);}.status-pill{display:inline-flex;align-items:center;gap:8px;font-size:13px;font-weight:600;padding:8px 14px;border-radius:999px;background:rgba(255,107,107,0.18);color:#ffb4b4;width:fit-content;}.status-pill.good{background:rgba(110,243,214,0.16);color:#b7fff1;}.status-detail{font-size:13px;color:rgba(255,255,255,0.65);}.hero-card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:24px;display:grid;gap:16px;box-shadow:var(--shadow);animation:floatIn 0.8s ease both;}.hero-card h2{margin:0;font-family:"Syne",sans-serif;font-size:20px;}.steps{margin:0;padding:0;list-style:none;display:grid;gap:12px;}.steps li{display:grid;grid-template-columns:28px 1fr;gap:12px;align-items:start;font-size:14px;color:var(--muted);}.steps li span{width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.08);display:grid;place-items:center;color:var(--ink);font-weight:700;}.card-actions{display:flex;gap:10px;flex-wrap:wrap;}.panel{margin-top:24px;background:var(--panel-strong);border:1px solid var(--border);border-radius:var(--radius);padding:22px;display:grid;gap:14px;box-shadow:var(--shadow);}.panel h2{margin:0;font-family:"Syne",sans-serif;font-size:20px;}.panel-head{display:flex;justify-content:space-between;align-items:center;gap:12px;}.host-row{display:flex;gap:10px;flex-wrap:wrap;}input[type="text"]{flex:1 1 260px;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(8,14,28,0.7);color:var(--ink);font-size:14px;}.kv{display:grid;gap:12px;}.kv div{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(255,255,255,0.12);padding-bottom:8px;}.kv span{color:var(--muted);font-size:12px;}.kv strong{font-weight:600;}.panel-actions{display:flex;gap:10px;flex-wrap:wrap;}.log-box{background:rgba(6,10,20,0.8);border:1px solid var(--border);border-radius:14px;padding:12px;min-height:140px;font-family:"SFMono-Regular",Consolas,"Liberation Mono",monospace;font-size:12px;color:#c9d7ff;white-space:pre-wrap;overflow:auto;}.site-footer{display:flex;justify-content:space-between;gap:12px;padding:24px clamp(24px,6vw,80px) 32px;color:rgba(255,255,255,0.5);font-size:12px;}button,.primary{border:none;font-family:"Onest",sans-serif;cursor:pointer;}.primary{display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#02111d;font-weight:600;padding:12px 18px;border-radius:12px;box-shadow:var(--shadow);text-decoration:none;transition:transform 0.2s ease,box-shadow 0.2s ease;}.primary:hover{transform:translateY(-1px);}.ghost{background:rgba(255,255,255,0.06);color:var(--ink);padding:12px 16px;border-radius:12px;border:1px solid var(--border);}.ghost:hover{border-color:rgba(255,255,255,0.2);}.small{padding:8px 12px;font-size:12px;}.hidden{display:none;}@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}@keyframes floatIn{from{opacity:0;transform:translateY(20px) scale(0.98);}to{opacity:1;transform:translateY(0) scale(1);}}@media (max-width:720px){.site-header{flex-direction:column;align-items:flex-start;gap:12px;}.site-footer{flex-direction:column;}}</style></head><body><div class="aura"></div><div class="gridline"></div><header class="site-header"><div class="brand"><div class="brand-mark">W</div><div class="brand-copy"><span class="brand-title">Wizyta</span><span class="brand-sub">Front + Powiernik offline</span></div></div><button class="ghost small" id="service-toggle">Tryb serwisowy</button></header><main class="wrap"><section class="hero"><div class="hero-text"><p class="kicker">/wizyta</p><h1>Wywiad medyczny szybciej i czytelniej.</h1><p class="lead"> Wizyta działa w przeglądarce, a Powiernik lokalnie obsługuje offline STT i bazę. Najpierw uruchom Powiernika, potem połącz się z tego panelu. </p><div class="hero-actions"><a class="primary" id="download-powiernik" href="AsystentSetup.exe" download> Pobierz Powiernika (Windows) </a><button class="ghost" id="connect-now">Mam już Powiernika → Połącz</button></div><div class="hint"> Jeśli Windows pokaże SmartScreen, wybierz „Więcej informacji” → „Uruchom mimo to”. </div><div class="status-pill" id="status-pill">Brak połączenia</div><div class="status-detail" id="status-detail">Uruchom Powiernika i kliknij „Połącz”.</div></div><div class="hero-card"><h2>3 proste kroki</h2><ol class="steps"><li><span>1</span><div><strong>Pobierz i zainstaluj Powiernika.</strong></div></li><li><span>2</span><div><strong>Uruchom Powiernika lokalnie.</strong> Otworzy się okno aplikacji.</div></li><li><span>3</span><div><strong>Wróć tu i kliknij „Połącz”.</strong></div></li></ol><div class="card-actions"><button class="ghost" id="open-local">Otwórz Powiernika</button><button class="ghost" id="scan-ports">Znajdź Powiernika</button></div></div></section><section class="panel hidden" id="connect-panel" aria-live="polite"><h2>Połączenie z Powiernikiem</h2><div class="host-row"><input id="host" type="text" value="http://127.0.0.1:8089" spellcheck="false" /><button class="ghost" id="save-host">Zapisz</button><button class="primary" id="connect-now-2">Sprawdź połączenie</button></div><p class="hint"> Jeśli przeglądarka blokuje HTTPS → HTTP, uruchom Powiernika z HTTPS lub użyj lokalnej strony. </p></section><section class="panel hidden" id="service-panel"><div class="panel-head"><h2>Tryb serwisowy</h2><button class="ghost" id="clear-logs">Wyczyść logi frontu</button></div><div class="kv"><div><span>Backend</span><strong id="backend-value">-</strong></div><div><span>Model</span><strong id="model-value">-</strong></div><div><span>Urządzenie</span><strong id="device-value">-</strong></div><div><span>Port</span><strong id="port-value">-</strong></div></div><div class="panel-actions"><button class="ghost" id="refresh-status">Odśwież status</button><button class="ghost" id="open-health">Otwórz /api/health</button><button class="primary" id="fetch-backend-logs">Pobierz logi hosta</button><button class="ghost" id="copy-debug">Skopiuj paczkę debug</button></div><div class="log-box" id="backend-log-preview">Logi hosta pojawią się tutaj…</div><div class="log-box" id="frontend-log-box"></div></section></main><footer class="site-footer"><span>Wizyta © 2026</span><span>GitHub Pages: guziczak.github.io/wizyta</span></footer><script>const state = { host: localStorage.getItem('wizytaHost') || 'http://127.0.0.1:8089', frontendLogs: [], backendLogs: '', lastHealth: null,
};
const $ = (id) => document.getElementById(id);
const hostInput = $('host');
const statusPill = $('status-pill');
const statusDetail = $('status-detail');
const backendValue = $('backend-value');
const modelValue = $('model-value');
const deviceValue = $('device-value');
const portValue = $('port-value');
const backendLogPreview = $('backend-log-preview');
const frontendLogBox = $('frontend-log-box');
const connectPanel = $('connect-panel');
const servicePanel = $('service-panel');
const log = (level, message, data) => { const entry = { time: new Date().toISOString(), level, message, data: data ?? null, }; state.frontendLogs.push(entry); if (state.frontendLogs.length > 300) { state.frontendLogs.shift(); } if (frontendLogBox) { const line = `[${entry.time}] [${level}] ${message}` + (data ? ` | ${JSON.stringify(data)}` : ''); frontendLogBox.textContent = `${line}\n${frontendLogBox.textContent}`.trim(); } if (level === 'error') { console.error(message, data || ''); } else { console.log(message, data || ''); }
};
const setStatus = (ok, title, subtitle) => { if (statusPill) { statusPill.textContent = title; statusPill.classList.toggle('good', ok); } if (statusDetail) { statusDetail.textContent = subtitle; }
};
const setHost = (value) => { state.host = value.trim(); if (hostInput) { hostInput.value = state.host; } localStorage.setItem('wizytaHost', state.host); log('info', 'Host ustawiony', { host: state.host });
};
const fetchWithTimeout = async (url, options = {}, timeoutMs = 2500) => { const controller = new AbortController(); const timeout = setTimeout(() => controller.abort(), timeoutMs); try { const res = await fetch(url, { ...options, signal: controller.signal, cache: 'no-store', }); return res; } finally { clearTimeout(timeout); }
};
const updateHealthUI = (data) => { if (backendValue) backendValue.textContent = data.backend || '-'; if (modelValue) modelValue.textContent = data.model || '-'; if (deviceValue) deviceValue.textContent = data.device || '-'; if (portValue) portValue.textContent = data.port ? String(data.port) : '-';
};
const checkHealth = async () => { try { const res = await fetchWithTimeout(`${state.host}/api/health`, { mode: 'cors' }, 3000); if (!res.ok) { throw new Error(`HTTP ${res.status}`); } const data = await res.json(); state.lastHealth = data; updateHealthUI(data); setStatus(true, 'Połączono', data.message || 'Powiernik działa poprawnie.'); log('info', 'Powiernik online', data); return true; } catch (err) { setStatus(false, 'Brak połączenia', 'Uruchom Powiernika i kliknij „Połącz”.'); log('error', 'Powiernik offline lub blokada przeglądarki', { error: String(err) }); return false; }
};
const scanPorts = async () => { log('info', 'Skanowanie portów 8089-8100...'); const ports = Array.from({ length: 12 }, (_, i) => 8089 + i); for (const port of ports) { const candidate = `${state.host.replace(/:\d+$/, '')}:${port}`; try { const res = await fetchWithTimeout(`${candidate}/api/health`, { mode: 'cors' }, 1200); if (res.ok) { setHost(candidate); await checkHealth(); return; } } catch (err) { // ignore } } log('warn', 'Nie znaleziono Powiernika na standardowych portach.');
};
const fetchBackendLogs = async () => { try { const res = await fetchWithTimeout(`${state.host}/api/debug/logs?tail=200`, { mode: 'cors' }, 4000); if (!res.ok) { throw new Error(`HTTP ${res.status}`); } const data = await res.json(); const text = data.lines ? data.lines.join('\n') : (data.stdout_lines || []).join('\n'); state.backendLogs = text || JSON.stringify(data, null, 2); if (backendLogPreview) { backendLogPreview.textContent = state.backendLogs || 'Brak logów.'; } log('info', 'Pobrano logi hosta', { lines: (data.lines || []).length }); } catch (err) { if (backendLogPreview) { backendLogPreview.textContent = `Błąd pobierania logów: ${err}`; } log('error', 'Nie udało się pobrać logów hosta', { error: String(err) }); }
};
const copyToClipboard = async (text) => { try { await navigator.clipboard.writeText(text); log('info', 'Skopiowano do schowka'); } catch (err) { log('error', 'Nie udało się skopiować do schowka', { error: String(err) }); }
};
const buildDebugBundle = () => { return JSON.stringify({ generated_at: new Date().toISOString(), host: state.host, user_agent: navigator.userAgent, health: state.lastHealth, frontend_logs: state.frontendLogs, backend_logs: state.backendLogs, }, null, 2);
};
const openLocal = (path) => { const url = `${state.host}${path}`; window.open(url, '_blank', 'noopener'); log('info', 'Otwarto lokalny adres', { url });
};
window.addEventListener('error', (event) => { log('error', 'Wyjątek frontu', { message: event.message, source: event.filename, line: event.lineno });
});
window.addEventListener('unhandledrejection', (event) => { log('error', 'Nieobsłużone odrzucenie', { reason: String(event.reason) });
});
if (hostInput) { hostInput.value = state.host;
}
const connectNow = $('connect-now');
const connectNow2 = $('connect-now-2');
const serviceToggle = $('service-toggle');
const openLocalBtn = $('open-local');
const scanPortsBtn = $('scan-ports');
if (connectNow && connectPanel) { connectNow.addEventListener('click', () => { connectPanel.classList.remove('hidden'); connectPanel.scrollIntoView({ behavior: 'smooth', block: 'start' }); if (hostInput) { hostInput.focus(); } });
}
if (connectNow2) { connectNow2.addEventListener('click', checkHealth);
}
if (serviceToggle && servicePanel) { serviceToggle.addEventListener('click', () => { servicePanel.classList.toggle('hidden'); if (!servicePanel.classList.contains('hidden')) { servicePanel.scrollIntoView({ behavior: 'smooth', block: 'start' }); } });
}
const saveHostBtn = $('save-host');
if (saveHostBtn && hostInput) { saveHostBtn.addEventListener('click', () => setHost(hostInput.value));
}
const refreshStatusBtn = $('refresh-status');
if (refreshStatusBtn) { refreshStatusBtn.addEventListener('click', checkHealth);
}
const openHealthBtn = $('open-health');
if (openHealthBtn) { openHealthBtn.addEventListener('click', () => openLocal('/api/health'));
}
const fetchBackendLogsBtn = $('fetch-backend-logs');
if (fetchBackendLogsBtn) { fetchBackendLogsBtn.addEventListener('click', fetchBackendLogs);
}
const copyDebugBtn = $('copy-debug');
if (copyDebugBtn) { copyDebugBtn.addEventListener('click', () => copyToClipboard(buildDebugBundle()));
}
const clearLogsBtn = $('clear-logs');
if (clearLogsBtn && frontendLogBox) { clearLogsBtn.addEventListener('click', () => { state.frontendLogs = []; frontendLogBox.textContent = ''; });
}
if (openLocalBtn) { openLocalBtn.addEventListener('click', () => openLocal('/'));
}
if (scanPortsBtn) { scanPortsBtn.addEventListener('click', scanPorts);
}
log('info', 'Front uruchomiony');
checkHealth();</script></body></html>
